var flowchart={s:{},debug:function(o){console.log("flowchart.js: "+o)},settings:{chart:{boxHeight:50,boxWidth:100,horizSpacing:20,vertSpacing:20,dropBoxOffset:5,dropBoxRadius:5,toolboxLeft:0,menuTop:0,animationSpeed:100},toolbox:{toolHeight:50,toolWidth:100,vertSpacing:20,toolRightGutter:20},forces:{c1:1,c2:20,c3:.1,c4:.01,c5:900,c6:.5,c7:15,t:1},viewBoxWidth:1200,viewBoxHeight:900},config:{drawToolbox:!1,draggable:!1,gridRows:8,gridCols:8},data:{boxes:[],lines:[],drops:[],tools:{boxTool:{},arrowTool:{}}},runtime:{scale:1,boxSelected:-1,dropZoneX:-1,dropZoneY:-1,dragInitialX:-1,dragInitialY:-1,boundingBox:{}},init:function(o,t){var a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("id","svg"),a.setAttribute("width","100%");var e=document.getElementById(o);if(e.appendChild(a),flowchart.s=Snap("#svg"),flowchart.s.addClass("flowchart"),void 0!==t)for(var r in t)t.hasOwnProperty(r)&&(flowchart.config[r]=t[r]);flowchart.config.drawToolbox&&flowchart.ops.drawToolbox(),flowchart.ops.drawDropZones(),flowchart.ops.drawFlowchartBoxes(),flowchart.ops.drawFlowchartLines(),flowchart.utils.updateViewBox(),flowchart.utils.updateScale(),flowchart.utils.addEvent(window,"resize",flowchart.utils.updateScale)},classes:{flowchartBox:function(){this.flowX=-1,this.flowY=-1,this.flowID=-1,this.svgElem={},this.lines=[]},flowchartLine:function(){this.startBoxID=-1,this.endBoxID=-1,this.firstX=-1,this.startX=-1,this.startY=-1,this.mainY=-1,this.endX=-1,this.endY=-1,this.lastX=-1,this.flowID=-1,this.svgElem={},this.mainForce=0,this.startForce=0,this.endForce=0}},handlers:{boxToolSelected:function(){flowchart.debug("boxTool selected"),flowchart.data.boxes.forEach(function(o){o.svgElem.unclick(),o.svgElem.undrag(),o.svgElem.drag(flowchart.handlers.boxToolDragMove,flowchart.handlers.boxToolDragStart,flowchart.handlers.boxToolDragEnd,o,o,o)}),flowchart.utils.removeClassFromAll("selected"),flowchart.data.tools.boxTool.addClass("selected")},boxToolDragMove:function(o,t,a,e){flowchart.debug("boxTool dragging box "+o+","+t+" to "+a+","+e);var r=flowchart.utils.bound(+flowchart.runtime.dragInitialX+o/flowchart.runtime.scale,flowchart.settings.chart.toolboxLeft,flowchart.runtime.boundingBox.width),l=flowchart.utils.bound(+flowchart.runtime.dragInitialY+t/flowchart.runtime.scale,flowchart.settings.chart.menuTop,flowchart.runtime.boundingBox.height);this.svgElem.attr({x:r,y:l}),flowchart.utils.highlightDrop(a,e)},boxToolDragStart:function(o,t){flowchart.debug("boxTool start dragging box at "+o+","+t),flowchart.runtime.dragInitialX=this.svgElem.attr("x"),flowchart.runtime.dragInitialY=this.svgElem.attr("y"),flowchart.utils.highlightDrop(o,t)},boxToolDragEnd:function(){flowchart.debug("boxTool end dragging"),flowchart.utils.animateToDropZone(this),flowchart.utils.highlightDropClear()},arrowToolSelected:function(){flowchart.debug("arrowTool selected"),flowchart.data.boxes.forEach(function(o){o.svgElem.unclick(),o.svgElem.undrag(),o.svgElem.click(flowchart.handlers.arrowToolClick)}),flowchart.utils.removeClassFromAll("selected"),flowchart.data.tools.arrowTool.addClass("selected"),flowchart.runtime.boxSelected=-1},arrowToolClick:function(){var o;boxSelected>0?(o=flowchart.data.boxes[boxSelected],flowchart.debug("drawing arrow from box at "+o.flow_x+","+o.flow_y+" to box at "+this.flow_x+","+this.flow_y)):(flowchart.debug("arrowTool selecting box at "+this.flow_x+","+this.flow_y),boxSelected=this.flow_id)}},ops:{drawToolbox:function(){var o=flowchart.settings.toolbox;flowchart.data.tools.boxTool=flowchart.s.rect(0,0,o.toolWidth,o.toolHeight),flowchart.data.tools.boxTool.addClass("boxTool"),flowchart.data.tools.arrowTool=flowchart.s.rect(0,o.toolHeight+o.vertSpacing,o.toolWidth,o.toolHeight),flowchart.data.tools.arrowTool.addClass("arrowTool"),flowchart.s.polyline(0,o.toolHeight+o.vertSpacing,o.toolWidth,o.toolHeight+o.vertSpacing+o.toolHeight).addClass("arrowToolLine"),flowchart.data.tools.boxTool.click(flowchart.handlers.boxToolSelected),flowchart.data.tools.arrowTool.click(flowchart.handlers.arrowToolSelected),flowchart.settings.chart.toolboxLeft=o.toolWidth+o.toolRightGutter},drawDropZones:function(){var o,t,a=flowchart.settings.chart;for(o=0;o<flowchart.config.gridRows;o++)for(flowchart.data.drops[o]=[],t=0;t<flowchart.config.gridCols;t++)flowchart.data.drops[o][t]=flowchart.s.rect(a.toolboxLeft+o*(a.boxWidth+a.horizSpacing),a.menuTop+t*(a.boxHeight+a.vertSpacing),a.boxWidth,a.boxHeight,a.dropBoxRadius,a.dropBoxRadius),flowchart.data.drops[o][t].addClass("dropZone")},drawFlowchartBoxes:function(){var o,t=flowchart.settings.chart;for(o=0;8>o;o++)flowchart.data.boxes[o]=new flowchart.classes.flowchartBox,flowchart.data.boxes[o].svgElem=flowchart.s.rect(t.toolboxLeft+t.dropBoxOffset+o*(t.boxWidth+t.horizSpacing),t.menuTop+t.dropBoxOffset+2*(t.boxHeight+t.horizSpacing),t.boxWidth-t.dropBoxOffset-t.dropBoxOffset,t.boxHeight-t.dropBoxOffset-t.dropBoxOffset),flowchart.data.boxes[o].svgElem.addClass("box"),flowchart.data.boxes[o].flowX=0,flowchart.data.boxes[o].flowY=2*o,flowchart.data.boxes[o].flowID=o,flowchart.data.boxes[o].svgElem.flowID=o},updateLine:function(o){var t=flowchart.data.boxes[o.startBoxID].svgElem.getBBox(),a=flowchart.data.boxes[o.endBoxID].svgElem.getBBox(),e=flowchart.settings.chart;o.firstX=t.x2,o.startX=t.x2+e.dropBoxOffset+e.horizSpacing/3,o.startY=t.cy,o.endX=a.x-e.dropBoxOffset-e.horizSpacing/3,o.endY=a.cy,o.lastX=a.x,o.mainY=o.startY<o.endY?t.y2+e.dropBoxOffset+e.vertSpacing/2:t.y-e.dropBoxOffset-e.vertSpacing/2,flowchart.ops.setLineAttrs(o)},setLineAttrs:function(o){o.svgElem.attr({points:[o.firstX,o.startY,o.startX,o.startY,o.startX,o.mainY,o.endX,o.mainY,o.endX,o.endY,o.lastX,o.endY]})},createLine:function(o,t){var a=new flowchart.classes.flowchartLine;return a.startBoxID=o.flowID,a.endBoxID=t.flowID,a.svgElem=flowchart.s.polyline(),a.svgElem.addClass("line"),flowchart.ops.updateLine(a),a.flowID=flowchart.data.lines.length,o.lines.push(a),t.lines.push(a),flowchart.data.lines.push(a),a},drawFlowchartLines:function(){flowchart.ops.createLine(flowchart.data.boxes[7],flowchart.data.boxes[0]),flowchart.ops.createLine(flowchart.data.boxes[0],flowchart.data.boxes[6]),flowchart.ops.createLine(flowchart.data.boxes[6],flowchart.data.boxes[1]),flowchart.ops.createLine(flowchart.data.boxes[1],flowchart.data.boxes[5]),flowchart.ops.createLine(flowchart.data.boxes[5],flowchart.data.boxes[2]),flowchart.ops.createLine(flowchart.data.boxes[2],flowchart.data.boxes[4]),flowchart.ops.createLine(flowchart.data.boxes[4],flowchart.data.boxes[3]),flowchart.ops.flowchartLineSpacing()},flowchartLineSpacing:function(){var o,t,a,e,r,l,n,i=0,c=flowchart.data.lines,s=flowchart.settings.forces;for(a=0;50>a;a++){for(i=0,o=0;o<c.length;o++){for(c[o].startY>c[o].mainY?(e=c[o].startY-c[o].mainY,r=Math.max(s.c4*Math.log(s.c5/e),0),c[o].mainForce+=r):(e=c[o].mainY-c[o].startY,r=Math.max(s.c4*Math.log(s.c5/e),0),c[o].mainForce-=r),c[o].endY>c[o].mainY?(e=c[o].endY-c[o].mainY,r=Math.max(s.c4*Math.log(s.c5/e),0),c[o].mainForce+=r):(e=c[o].mainY-c[o].endY,r=Math.max(s.c4*Math.log(s.c5/e),0),c[o].mainForce-=r),l=flowchart.settings.chart.menuTop+flowchart.settings.chart.boxHeight,n=flowchart.settings.chart.menuTop+flowchart.settings.chart.boxHeight+flowchart.settings.chart.vertSpacing;!(c[o].mainY>=l-flowchart.settings.chart.boxHeight/2&&c[o].mainY<=n+flowchart.settings.chart.boxHeight/2);)l+=flowchart.settings.chart.boxHeight+flowchart.settings.chart.vertSpacing,n+=flowchart.settings.chart.boxHeight+flowchart.settings.chart.vertSpacing;if(e=c[o].mainY-l+1,0>=e)c[o].mainY-=flowchart.settings.chart.boxHeight,flowchart.debug("Iteration "+a+": jumped line "+o+" up a channel to "+c[o].mainY),c[o].mainForce=0;else if(r=Math.max(s.c6*Math.log(s.c7/e),0),c[o].mainForce+=r,e=n-c[o].mainY+1,0>=e)c[o].mainY+=flowchart.settings.chart.boxHeight,flowchart.debug("Iteration "+a+": jumped line "+o+" down a channel to "+c[o].mainY),c[o].mainForce=0;else{for(r=Math.max(s.c6*Math.log(s.c7/e),0),c[o].mainForce-=r,t=o+1;t<c.length;t++)flowchart.utils.linesOverlap(c[o].startX,c[o].endX,c[t].startX,c[t].endX)&&(r=flowchart.ops.compareLines(c[o],c[t],"mainY","mainY","mainForce","mainForce"),i=r>i?r:i),flowchart.utils.linesOverlap(c[o].startY,c[o].mainY,c[t].startY,c[t].mainY)&&(r=flowchart.ops.compareLines(c[o],c[t],"startX","startX","startForce","startForce"),i=r>i?r:i),flowchart.utils.linesOverlap(c[o].startY,c[o].mainY,c[t].endY,c[t].mainY)&&(r=flowchart.ops.compareLines(c[o],c[t],"startX","endX","startForce","endForce"),i=r>i?r:i),flowchart.utils.linesOverlap(c[o].endY,c[o].mainY,c[t].startY,c[t].mainY)&&(r=flowchart.ops.compareLines(c[o],c[t],"endX","startX","endForce","startForce"),i=r>i?r:i),flowchart.utils.linesOverlap(c[o].endY,c[o].mainY,c[t].endY,c[t].mainY)&&(r=flowchart.ops.compareLines(c[o],c[t],"endX","endX","endForce","endForce"),i=r>i?r:i);c[o].mainY=+c[o].mainY+ +s.c3*c[o].mainForce,c[o].startX=+c[o].startX+ +s.c3*c[o].startForce,c[o].endX=+c[o].endX+ +s.c3*c[o].endForce,flowchart.ops.setLineAttrs(c[o]),flowchart.debug("Iteration "+a+": moved line "+o+" to "+c[o].startX+","+c[o].mainY+","+c[o].endX),c[o].mainForce=0,c[o].startForce=0,c[o].endForce=0}}if(i<s.t)break}},compareLines:function(o,t,a,e,r,l){var n,i,c=flowchart.settings.forces;return Math.abs(o[a]-t[e])<=c.c2?(o[a]>t[e]?(i=o[a]-t[e]+.1,n=Math.max(c.c1*Math.log(c.c2/i),0),o[r]+=n,t[l]-=n):(i=t[e]-o[a]+.1,n=Math.max(c.c1*Math.log(c.c2/i),0),o[r]-=n,t[l]+=n),n):0}},utils:{removeClassFromAll:function(o){flowchart.s.selectAll("."+o).forEach(function(t){t.removeClass(o)})},linesOverlap:function(o,t,a,e){var r,l,n,i;return t>o?(r=o,l=t):(r=t,l=o),e>a?(n=a,i=e):(n=e,i=a),n>=r&&l+flowchart.settings.forces.c2>=n?!0:r>=n&&i+flowchart.settings.forces.c2>=r?!0:!1},highlightDrop:function(o,t){var a=flowchart.settings.chart,e=flowchart.runtime,r=Math.floor((o/e.scale-a.toolboxLeft)/(a.boxWidth+a.horizSpacing)),l=Math.floor((t/e.scale-a.menuTop)/(a.boxHeight+a.vertSpacing));(r!=e.dropZoneX||l!=e.dropZoneY)&&(flowchart.utils.highlightDropClear(),r>=0&&r<flowchart.config.gridRows&&l>=0&&l<flowchart.config.gridCols?(e.dropZoneX=r,e.dropZoneY=l,flowchart.data.drops[e.dropZoneX][e.dropZoneY].addClass("hover")):(e.dropZoneX=-1,e.dropZoneY=-1))},highlightDropClear:function(){var o=flowchart.runtime;o.dropZoneX>=0&&o.dropZoneY>=0&&flowchart.data.drops[o.dropZoneX][o.dropZoneY].removeClass("hover"),o.dropZoneX=-1,o.dropZoneY=-1},animateToDropZone:function(o){var t=flowchart.settings.chart,a=flowchart.runtime;if(a.dropZoneX>=0&&a.dropZoneY>=0){var e=t.toolboxLeft+t.dropBoxOffset+a.dropZoneX*(t.boxWidth+t.vertSpacing),r=t.menuTop+t.dropBoxOffset+a.dropZoneY*(t.boxHeight+t.horizSpacing);o.svgElem.animate({x:e,y:r},t.animationSpeed,mina.linear,function(){flowchart.utils.updateLines(o)}),o.flowX=flowchart.runtime.dropZoneX,o.flowY=flowchart.runtime.dropZoneY}else{var e=t.toolboxLeft+t.dropBoxOffset+o.flowX*(t.boxWidth+t.vertSpacing),r=t.menuTop+t.dropBoxOffset+o.flowY*(t.boxHeight+t.horizSpacing);o.svgElem.animate({x:e,y:r},t.animationSpeed,mina.linear,function(){flowchart.utils.updateLines(o)})}},updateLines:function(o){flowchart.debug("Updating lines after move"),flowchart.data.lines.forEach(function(o){flowchart.ops.updateLine(o)}),flowchart.ops.flowchartLineSpacing()},updateScale:function(){var o=document.getElementById("svg").getAttribute("viewBox").split(" "),t=document.getElementById("svg").parentNode.clientHeight,a=document.getElementById("svg").parentNode.clientHeight;flowchart.runtime.scale=Math.max(a/o[2],t/o[3]),flowchart.debug("scale updated to "+flowchart.runtime.scale+" based on dimensions "+a+"x"+t)},updateViewBox:function(){flowchart.runtime.boundingBox=flowchart.s.getBBox(),document.getElementById("svg").setAttribute("viewBox","0 0 "+flowchart.runtime.boundingBox.width+" "+flowchart.runtime.boundingBox.height)},addEvent:function(o,t,a){null!==o&&"undefined"!=typeof o&&(o.addEventListener?o.addEventListener(t,a,!1):o.attachEvent?o.attachEvent("on"+t,a):o["on"+t]=a)},bound:function(o,t,a){return t>o?t:o>a?a:o}}};window.onload=function(){flowchart.init("svgcont",{drawToolbox:!0})};