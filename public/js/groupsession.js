"use strict";require(["util/site","pusher","react","react-dom","ionsound"],function(e,t,s,n,r){e.ajaxcrsf(),ion.sound({sounds:[{name:"door_bell"}],volume:1,path:"/sounds/",preload:!0});var a=parseInt($("#userID").val()),o=parseInt($("#isAdvisor").val()),u=function(){$("#groupRegisterBtn").removeAttr("disabled")},i=function(){$("#groupRegisterBtn").attr("disabled","disabled")},d=function(e){for(var t=e.length,s=!1,n=0;t>n;n++)if(e[n].userid===a){s=!0;break}s?i():u()},l=function(e){2==e.status&&ion.sound.play("door_bell")},p=function(e){for(var t=e.length,s=0;t>s;s++)if(e[s].userid===a){l(e[s]);break}},c=function(e,t){return e.status==t.status?e.id<t.id?-1:1:e.status<t.status?1:-1},g=function(e){return 0===e.status?"NEW":1===e.status?"QUEUED":2===e.status?"MEET WITH "+e.advisor:3===e.status?"DELAY":4===e.status?"ABSENT":5===e.status?"DONE":void 0};$("#groupRegisterBtn").on("click",function(){$("#groupSpin").removeClass("hide-spin"),$.ajax({method:"POST",url:"/groupsession/register"}).success(function(t){e.displayMessage(t,"success"),e.clearFormErrors(),i(),$("#groupSpin").addClass("hide-spin")}).fail(function(t,s){422==t.status?e.setFormErrors(t.responseJSON):alert("Unable to register: "+t.responseJSON),$("#groupSpin").addClass("hide-spin")})}),$("#groupDisableBtn").on("click",function(){var e=confirm("Are you sure?");if(e===!0){var t=confirm("Seriously, this will lose all current data. Are you really sure?");if(t===!0){var s=$('meta[name="csrf-token"]').attr("content");$('<form action="/groupsession/disable" method="POST"/>').append($('<input type="hidden" name="id" value="'+a+'">')).append($('<input type="hidden" name="_token" value="'+s+'">')).appendTo($(document.body)).submit()}}});var m=new Pusher(pusherKey),f=m.subscribe("groupsession");m.connection.bind("connected",function(){$("#groupSpin").addClass("hide-spin")}),Pusher.log=function(e){window.console&&window.console.log&&window.console.log(e)};var h=s.createClass({displayName:"StudentRow",takeStudent:function(t){var s=t.currentTarget.dataset.id;$.ajax({method:"POST",url:"/groupsession/take",data:{gid:s}}).success(function(t){e.displayMessage(t,"success")}).fail(function(t,s){422==t.status?e.setFormErrors(t.responseJSON):alert("Unable to take: "+t.responseJSON)})},putStudent:function(t){var s=t.currentTarget.dataset.id;$.ajax({method:"POST",url:"/groupsession/put",data:{gid:s}}).success(function(t){e.displayMessage(t,"success")}).fail(function(t,s){422==t.status?e.setFormErrors(t.responseJSON):alert("Unable to put: "+t.responseJSON)})},doneStudent:function(t){var s=t.currentTarget.dataset.id;$.ajax({method:"POST",url:"/groupsession/done",data:{gid:s}}).success(function(t){e.displayMessage(t,"success")}).fail(function(t,s){422==t.status?e.setFormErrors(t.responseJSON):alert("Unable to mark done: "+t.responseJSON)})},delStudent:function(t){var s=t.currentTarget.dataset.id;$.ajax({method:"POST",url:"/groupsession/delete",data:{gid:s}}).success(function(t){e.displayMessage(t,"success")}).fail(function(t,s){422==t.status?e.setFormErrors(t.responseJSON):alert("Unable to delete: "+t.responseJSON)})},render:function(){var e=g(this.props.student);if(1!==o){if(0==this.props.student.status||1==this.props.student.status)var t="alert alert-info groupsession-div";else if(2==this.props.student.status)var t="alert alert-success groupsession-div";if(a===this.props.student.userid){var n=s.createElement("b",null,this.props.student.name);t+=" groupsession-me"}else var n=this.props.student.name;return s.createElement("div",{className:t,role:"alert"},n," ",s.createElement("span",{className:"badge"},e))}return 0==this.props.student.status||1==this.props.student.status?s.createElement("div",{className:"alert alert-info groupsession-div",role:"alert"},s.createElement("button",{className:"btn btn-danger pull-right groupsession-button del-button","data-id":this.props.student.id,onClick:this.delStudent},"X"),s.createElement("button",{className:"btn btn-success pull-right groupsession-button take-button","data-id":this.props.student.id,onClick:this.takeStudent},"Take"),this.props.student.name," ",s.createElement("span",{className:"badge"},e)):2==this.props.student.status?s.createElement("div",{className:"alert alert-success groupsession-div",role:"alert"},s.createElement("button",{className:"btn btn-danger pull-right groupsession-button del-button","data-id":this.props.student.id,onClick:this.delStudent},"X"),s.createElement("button",{className:"btn btn-primary pull-right groupsession-button done-button","data-id":this.props.student.id,onClick:this.doneStudent},"Done"),s.createElement("button",{className:"btn btn-info pull-right groupsession-button put-button","data-id":this.props.student.id,onClick:this.putStudent},"Requeue"),this.props.student.name," ",s.createElement("span",{className:"badge"},e)):void 0}}),b=s.createClass({displayName:"GroupList",getInitialState:function(){return{queue:[]}},componentDidMount:function(){var t=this;f.bind("App\\Events\\GroupsessionRegister",function(e){for(var s=t.state.queue,n=!1,r=s.length,o=0;r>o;o++)s[o].id===e.id&&(e.status<3?s[o]=e:(s.splice(o,1),o--,r--),n=!0);n||s.push(e),d(s),e.userid===a&&l(e),s.sort(c),t.setState({queue:s})}),f.bind("App\\Events\\GroupsessionEnd",function(e){window.location.href="/groupsession"}),$.ajax({method:"GET",url:"/groupsession/queue"}).success(function(e){var s=t.state.queue.concat(JSON.parse(e));d(s),p(s),s.sort(c),t.setState({queue:s})}).fail(function(t,s){422==t.status?e.setFormErrors(t.responseJSON):alert("Unable to get queue: "+t.responseJSON)})},render:function(){var e=[];return this.state.queue.forEach(function(t){e.push(s.createElement(h,{key:t.id,student:t}))}),s.createElement("div",null,e)}});n.render(s.createElement(b,null),document.getElementById("groupList"))});