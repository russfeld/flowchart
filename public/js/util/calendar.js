define(["jquery","bootstrap","jquery.autocomplete","moment","bootstrap-datetimepicker","fullcalendar","util/site"],function(e,t,a,n,i,d,s){function r(){var e=this;e.session={},e.calendarAdivisorID=-1;var t="";e.calendarData={header:{left:"prev,next today",center:"title",right:"agendaWeek,agendaDay"},editable:!1,eventLimit:!0,height:"auto",weekends:!1,businessHours:{start:"8:00",end:"17:00",dow:[1,2,3,4,5]},defaultView:"agendaWeek",views:{agenda:{allDaySlot:!1,slotDuration:"00:20:00",minTime:"08:00:00",maxTime:"17:00:00"}},eventSources:[{url:"/advising/meetingfeed",type:"GET",error:function(){alert("Error fetching meeting events from database")},color:"#512888",textColor:"white"},{url:"/advising/blackoutfeed",type:"GET",error:function(){alert("Error fetching blackout events from database")},color:"#FF8888",textColor:"black"}],selectable:!0,selectHelper:!0,selectOverlap:function(e){return"background"===e.rendering},timeFormat:" "},e.datePickerData={daysOfWeekDisabled:[0,6],format:"LLL",stepping:20,enabledHours:[8,9,10,11,12,13,14,15,16,17],maxHour:17,sideBySide:!0,ignoreReadonly:!0,allowInputToggle:!0},e.datePickerDateOnly={daysOfWeekDisabled:[0,6],format:"MM/DD/YYYY",ignoreReadonly:!0,allowInputToggle:!0},e.init=function(n){n||(n=!1),e.calendarAdvisorID=$("#calendarAdvisorID").val().trim(),n?($("#createEvent").on("shown.bs.modal",function(){$("#studentid").focus()}),$("#title").prop("disabled",!0),$("#start").prop("disabled",!1),$("#studentid").prop("disabled",!1),$("#start_span").removeClass("datepicker-disabled"),$("#end").prop("disabled",!1),$("#end_span").removeClass("datepicker-disabled"),$("#studentiddiv").show(),$("#createEvent").on("hidden.bs.modal",e.resetForm)):($("#createEvent").on("shown.bs.modal",function(){$("#desc").focus()}),$("#title").prop("disabled",!0),$("#start").prop("disabled",!0),$("#studentid").prop("disabled",!0),$("#start_span").addClass("datepicker-disabled"),$("#end").prop("disabled",!0),$("#end_span").addClass("datepicker-disabled"),$("#studentiddiv").hide(),$("#studentidval").val(-1),t=$("#studentName").val().trim(),$(".modal").on("hidden.bs.modal",e.resetForm)),$("#saveButton").bind("click",a),$("#deleteButton").bind("click",i),$("#duration").on("change",r)};var a=function(){$("#createEventSpin").removeClass("hide-spin");var t={start:n($("#start").val(),"LLL").format(),end:n($("#end").val(),"LLL").format(),title:$("#title").val(),desc:$("#desc").val()};t.id=e.calendarAdvisorID,$("#meetingID").val()>0&&(t.meetingid=$("#meetingID").val()),$("#studentidval").val()>0&&(t.studentid=$("#studentidval").val()),$.ajax({method:"POST",url:"/advising/createmeeting",data:t}).success(function(e){$("#createEvent").modal("hide"),s.displayMessage(e,"success"),$("#calendar").fullCalendar("unselect"),$("#calendar").fullCalendar("refetchEvents"),$("#createEventSpin").addClass("hide-spin")}).fail(function(e,t){422==e.status?s.setFormErrors(e.responseJSON):alert("Unable to save meeting: "+e.responseJSON),$("#createEventSpin").addClass("hide-spin")})},i=function(){var e=confirm("Are you sure?");e===!0&&($("#createEventSpin").removeClass("hide-spin"),$.ajax({method:"POST",url:"/advising/deletemeeting",data:{meetingid:$("#meetingID").val()}}).success(function(e){$("#createEvent").modal("hide"),s.displayMessage(e,"success"),$("#calendar").fullCalendar("unselect"),$("#calendar").fullCalendar("refetchEvents"),$("#createEventSpin").addClass("hide-spin")}).fail(function(e,t){alert("Unable to delete meeting: "+e.responseJSON),$("#createEventSpin").addClass("hide-spin")}))};e.showMeetingForm=function(e){$("#title").val(e.title),$("#start").val(e.start.format("LLL")),$("#end").val(e.end.format("LLL")),$("#desc").val(e.desc),d(e.start,e.end),$("#meetingID").val(e.id),$("#studentidval").val(e.student_id),$("#deleteButton").show(),$("#createEvent").modal("show")},e.createMeetingForm=function(t){$("#title").val(void 0!==t?t:""),$("#start").val(void 0===e.session.start?n().hour(8).minute(0).format("LLL"):e.session.start.format("LLL")),$("#end").val(void 0===e.session.end?n().hour(8).minute(20).format("LLL"):e.session.end.format("LLL")),void 0===e.session.start?d(n().hour(8).minute(0),n().hour(8).minute(20)):d(e.session.start,e.session.end),$("#meetingID").val(-1),$("#studentidval").val(-1),$("#deleteButton").hide(),$("#createEvent").modal("show")},e.resetForm=function(){$(this).find("form")[0].reset(),s.clearFormErrors()};var d=function(e,t){$("#duration").empty(),$("#duration").append("<option value='20'>20 minutes</option>"),(e.hour()<16||16==e.hour()&&e.minutes()<=20)&&$("#duration").append("<option value='40'>40 minutes</option>"),(e.hour()<16||16==e.hour()&&e.minutes()<=0)&&$("#duration").append("<option value='60'>60 minutes</option>"),$("#duration").val(t.diff(e,"minutes"))};e.linkDatePickers=function(e,t,a){$(e+"_datepicker").on("dp.change",function(e){var a=n($(t).val(),"LLL");(e.date.isAfter(a)||e.date.isSame(a))&&(a=e.date.clone(),$(t).val(a.format("LLL")))}),$(t+"_datepicker").on("dp.change",function(t){var a=n($(e).val(),"LLL");(t.date.isBefore(a)||t.date.isSame(a))&&(a=t.date.clone(),$(e).val(a.format("LLL")))})};var r=function(){var e=n($("#start").val(),"LLL").add($(this).val(),"minutes");$("#end").val(e.format("LLL"))};e.studentSelect=function(a,n){n.diff(a,"minutes")>60?(alert("Meetings cannot last longer than 1 hour"),$("#calendar").fullCalendar("unselect")):(e.session={start:a,end:n},$("#meetingID").val(-1),e.createMeetingForm(t))}}return new r});