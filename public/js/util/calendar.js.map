{"version":3,"sources":["calendar.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"calendar.js","sourcesContent":["define(['jquery', 'bootstrap', 'jquery.autocomplete', 'moment', 'bootstrap-datetimepicker', 'fullcalendar', 'util/site'], function(jquery, bootstrap, jqueryac, moment, boostrapdt, fullcalendar, site) {\n\n\tfunction calendarModule() {\n\t\t//self-referential variable\n\t\t//anything attached to this or self will be public\n\t\tvar self = this;\n\n\t\t//Temporary session for storing information between forms\n\t\tself.session = {};\n\n\t\t//ID of the currently loaded calendar's advisor\n\t\tself.calendarAdivisorID = -1;\n\n\t\t//UNKNOWN??\n\t\tvar studentName = \"\";\n\n\t\t//Configuration data for fullcalendar instance\n\t\tself.calendarData = {\n\t\t\theader: {\n\t\t\t\tleft: 'prev,next today',\n\t\t\t\tcenter: 'title',\n\t\t\t\tright: 'agendaWeek,agendaDay'\n\t\t\t},\n\t\t\teditable: false,\n\t\t\teventLimit: true,\n\t\t\theight: 'auto',\n\t\t\tweekends: false,\n\t\t\tbusinessHours: {\n\t\t\t\tstart: '8:00', // a start time (10am in this example)\n\t\t\t\tend: '17:00', // an end time (6pm in this example)\n\t\t\t\tdow: [ 1, 2, 3, 4, 5 ]\n\t\t\t},\n\t\t\tdefaultView: 'agendaWeek',\n\t\t\tviews: {\n\t\t\t\tagenda: {\n\t\t\t\t\tallDaySlot: false,\n\t\t\t\t\tslotDuration: '00:20:00',\n\t\t\t\t\tminTime: '08:00:00',\n\t\t\t\t\tmaxTime: '17:00:00'\n\t\t\t\t}\n\t\t\t},\n\t\t\teventSources: [\n\t\t\t\t{\n\t\t\t\t\turl: '/advising/meetingfeed',\n\t\t\t\t\ttype: 'GET',\n\t\t\t\t\terror: function() {\n\t\t\t\t\t\talert('Error fetching meeting events from database');\n\t\t\t\t\t},\n\t\t\t\t\tcolor: '#512888',\n\t\t\t\t\ttextColor: 'white',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\turl: '/advising/blackoutfeed',\n\t\t\t\t\ttype: 'GET',\n\t\t\t\t\terror: function() {\n\t\t\t\t\t\talert('Error fetching blackout events from database');\n\t\t\t\t\t},\n\t\t\t\t\tcolor: '#FF8888',\n\t\t\t\t\ttextColor: 'black',\n\t\t\t\t},\n\t\t\t],\n\t\t\tselectable: true,\n\t\t\tselectHelper: true,\n\t\t\tselectOverlap: function(event) {\n\t\t\t\treturn event.rendering === 'background';\n\t\t\t},\n\t\t\ttimeFormat: ' ',\n\t\t};\n\n\t\t//Configuration data for datepicker instance\n\t\tvar datePickerData = {\n\t\t\t\tdaysOfWeekDisabled: [0, 6],\n\t\t\t\tformat: 'LLL',\n\t\t\t\tstepping: 20,\n\t\t\t\tenabledHours: [8, 9, 10, 11, 12, 13, 14, 15, 16, 17],\n\t\t\t\tmaxHour: 17,\n\t\t\t\tsideBySide: true,\n\t\t\t\tignoreReadonly: true,\n\t\t\t\tallowInputToggle: true\n\t\t};\n\n\t\t//Configuration data for datepicker instance day only\n\t\tvar datePickerDateOnly = {\n\t\t\t\tdaysOfWeekDisabled: [0, 6],\n\t\t\t\tformat: 'MM/DD/YYYY',\n\t\t\t\tignoreReadonly: true,\n\t\t\t\tallowInputToggle: true\n\t\t};\n\n\t\t//Function to initialize the fullcalendar instance\n\t\tself.init = function(advisor = false){\n\n\t\t\tself.calendarAdvisorID = $('#calendarAdvisorID').val().trim();\n\n\t\t\tif(advisor){\n\t\t\t\t$('#createEvent').on('shown.bs.modal', function () {\n\t\t\t\t  $('#studentid').focus();\n\t\t\t\t});\n\n\t\t\t\t$('#title').prop('disabled', true);\n\t\t\t\t$('#start').prop('disabled', false);\n\t\t\t\t$('#studentid').prop('disabled', false);\n\t\t\t\t$('#start_span').removeClass('datepicker-disabled');\n\t\t\t\t$('#end').prop('disabled', false);\n\t\t\t\t$('#end_span').removeClass('datepicker-disabled');\n\t\t\t\t$('#studentiddiv').show();\n\n\t\t\t\t$('#createEvent').on('hidden.bs.modal', self.resetForm);\n\t\t\t}else{\n\t\t\t\t$('#createEvent').on('shown.bs.modal', function () {\n\t\t\t\t  $('#desc').focus();\n\t\t\t\t});\n\n\t\t\t\t$('#title').prop('disabled', true);\n\t\t\t\t$(\"#start\").prop('disabled', true);\n\t\t\t\t$('#studentid').prop('disabled', true);\n\t\t\t\t$(\"#start_span\").addClass('datepicker-disabled');\n\t\t\t\t$(\"#end\").prop('disabled', true);\n\t\t\t\t$(\"#end_span\").addClass('datepicker-disabled');\n\t\t\t\t$('#studentiddiv').hide();\n\t\t\t\t$('#studentidval').val(-1);\n\n\t\t\t\tstudentName = $('#studentName').val().trim();\n\n\t\t\t\t$('.modal').on('hidden.bs.modal', self.resetForm);\n\t\t\t}\n\n\n\t\t\t$('#saveButton').bind('click', saveMeeting);\n\t\t\t$('#deleteButton').bind('click', deleteMeeting);\n\t\t\t$('#duration').on('change', changeDuration);\n\t\t}\n\n\t\t//AJAX function to save a meeting\n\t\tvar saveMeeting = function(){\n\t\t\t$('#createEventSpin').removeClass('hide-spin');\n\t\t\tvar data = {\n\t\t\t\tstart: moment($('#start').val(), \"LLL\").format(),\n\t\t\t\tend: moment($('#end').val(), \"LLL\").format(),\n\t\t\t\ttitle: $('#title').val(),\n\t\t\t\tdesc: $('#desc').val()\n\t\t\t};\n\t\t\tdata.id = self.calendarAdvisorID;\n\t\t\tif($('#meetingID').val() > 0){\n\t\t\t\tdata.meetingid = $('#meetingID').val();\n\t\t\t}\n\t\t\tif($('#studentidval').val() > 0){\n\t\t\t\tdata.studentid = $('#studentidval').val();\n\t\t\t}\n\t\t\t$.ajax({\n\t\t\t  method: \"POST\",\n\t\t\t  url: '/advising/createmeeting',\n\t\t\t  data: data\n\t\t\t})\n\t\t\t.success(function( message ) {\n\t\t\t\t$('#createEvent').modal('hide');\n\t\t\t\tsite.displayMessage(message, \"success\");\n\t\t\t\t$('#calendar').fullCalendar('unselect');\n\t\t\t\t$('#calendar').fullCalendar('refetchEvents');\n\t\t\t\t$('#createEventSpin').addClass('hide-spin');\n\t\t\t}).fail(function( jqXHR, message ){\n\t\t\t\tif (jqXHR.status == 422)\n\t\t\t\t{\n\t\t\t\t\t$('.form-group').each(function (){\n\t\t\t\t\t\t$(this).removeClass('has-error');\n\t\t\t\t\t\t$(this).find('.help-block').text('');\n\t\t\t\t\t});\n\t\t\t\t\t$.each(jqXHR.responseJSON, function (key, value) {\n\t\t\t\t\t\t$('#' + key).parents('.form-group').addClass('has-error');\n\t\t\t\t\t\t$('#' + key + 'help').text(value);\n\t\t\t\t\t});\n\t\t\t\t}else{\n\t\t\t\t\talert(\"Unable to save meeting: \" + jqXHR.responseJSON);\n\t\t\t\t}\n\t\t\t\t$('#createEventSpin').addClass('hide-spin');\n\t\t\t});\n\t\t};\n\n\t\t//AJAX function to delete a meeting\n\t\tvar deleteMeeting = function(){\n\t\t\tvar choice = confirm(\"Are you sure?\");\n\t\t\tif(choice === true){\n\t\t\t\t$('#createEventSpin').removeClass('hide-spin');\n\t\t\t\t$.ajax({\n\t\t\t\t  method: \"POST\",\n\t\t\t\t  url: '/advising/deletemeeting',\n\t\t\t\t  data: { meetingid: $('#meetingID').val() }\n\t\t\t\t})\n\t\t\t\t.success(function( message ) {\n\t\t\t\t\t$('#createEvent').modal('hide');\n\t\t\t\t\tsite.displayMessage(message, \"success\");\n\t\t\t\t\t$('#calendar').fullCalendar('unselect');\n\t\t\t\t\t$('#calendar').fullCalendar('refetchEvents');\n\t\t\t\t\t$('#createEventSpin').addClass('hide-spin');\n\t\t\t\t}).fail(function( jqXHR, message ){\n\t\t\t\t\talert(\"Unable to delete meeting: \" + jqXHR.responseJSON);\n\t\t\t\t\t$('#createEventSpin').addClass('hide-spin');\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\t//Function to reset and show the meeting form for editing\n\t\tself.showMeetingForm = function(event){\n\t\t\t$('#title').val(event.title);\n\t\t\t$('#start').val(event.start.format(\"LLL\"));\n\t\t\t$('#end').val(event.end.format(\"LLL\"));\n\t\t\t$('#desc').val(event.desc);\n\t\t\tdurationOptions(event.start, event.end);\n\t\t\t$('#meetingID').val(event.id);\n\t\t\t$('#studentidval').val(event.student_id);\n\t\t\t$('#deleteButton').show();\n\t\t\t$('#createEvent').modal('show');\n\t\t};\n\n\t\t//Function to reset and show the meeting form for creation\n\t\tself.createMeetingForm = function(studentName){\n\t\t\tif(studentName !== undefined){\n\t\t\t\t$('#title').val(studentName);\n\t\t\t}else{\n\t\t\t\t$('#title').val('');\n\t\t\t}\n\t\t\t$('#start').val(session.start.format(\"LLL\"));\n\t\t\t$('#end').val(session.end.format(\"LLL\"));\n\t\t\tdurationOptions(session.start, session.end);\n\t\t\t$('#meetingID').val(-1);\n\t\t\t$('#studentidval').val(-1);\n\t\t\t$('#deleteButton').hide();\n\t\t\t$('#createEvent').modal('show');\n\t\t};\n\n\t\t//Function to reset the form\n\t\tself.resetForm = function(){\n\t\t    $(this).find('form')[0].reset();\n\t\t    $(this).find('.has-error').each(function(){\n\t\t\t\t$(this).removeClass('has-error');\n\t\t\t});\n\t\t\t$(this).find('.help-block').each(function(){\n\t\t\t\t$(this).text('');\n\t\t\t});\n\t\t};\n\n\t\t//Function to set duration options for the meeting form\n\t\tvar durationOptions = function(start, end){\n\t\t\t$('#duration').empty();\n\t\t\t$('#duration').append(\"<option value='20'>20 minutes</option>\");\n\t\t\tif(start.hour() < 16 || (start.hour() == 16 && start.minutes() <= 20)){\n\t\t\t\t$('#duration').append(\"<option value='40'>40 minutes</option>\");\n\t\t\t}\n\t\t\tif(start.hour() < 16 || (start.hour() == 16 && start.minutes() <= 0)){\n\t\t\t\t$('#duration').append(\"<option value='60'>60 minutes</option>\");\n\t\t\t}\n\t\t\t$('#duration').val(end.diff(start, \"minutes\"));\n\t\t};\n\n\t\t//Function to link the datepickers together\n\t\tvar linkDatePickers = function(elem1, elem2, duration){\n\t\t\t$(elem1 + \"_datepicker\").on(\"dp.change\", function (e) {\n\t\t\t\tvar date2 = moment($(elem2).val(), 'LLL');\n\t\t\t\tif(e.date.isAfter(date2) || e.date.isSame(date2)){\n\t\t\t\t\tdate2 = e.date.clone();\n\t\t\t\t\t$(elem2).val(date2.format(\"LLL\"));\n\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t$(elem2 + \"_datepicker\").on(\"dp.change\", function (e) {\n\t\t\t\t\t\tvar date1 = moment($(elem1).val(), 'LLL');\n\t\t\t\tif(e.date.isBefore(date1) || e.date.isSame(date1)){\n\t\t\t\t\tdate1 = e.date.clone();\n\t\t\t\t\t$(elem1).val(date1.format(\"LLL\"));\n\t\t\t\t}\n\t\t\t\t});\n\t\t};\n\n\t\t//Function to change the duration of the meeting\n\t\tvar changeDuration = function(){\n\t\t\tvar newDate = moment($('#start').val(), 'LLL').add($(this).val(), \"minutes\");\n\t\t\t$('#end').val(newDate.format(\"LLL\"));\n\t\t};\n\n\t\t//Function to verify that the students are selecting meetings that aren't too long\n\t\tself.studentSelect = function(start, end) {\n\t\t\tif(end.diff(start, 'minutes') > 60){\n\t\t\t\talert(\"Meetings cannot last longer than 1 hour\");\n\t\t\t\t$('#calendar').fullCalendar('unselect');\n\t\t\t}else{\n\t\t\t\tsession = {\n\t\t\t\t\tstart: start,\n\t\t\t\t\tend: end\n\t\t\t\t};\n\t\t\t\t$('#meetingID').val(-1);\n\t\t\t\tself.createMeetingForm(studentName);\n\t\t\t}\n\t\t};\n\t};\n\n\treturn new calendarModule();\n});\n"],"sourceRoot":"/source/"}